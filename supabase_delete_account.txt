
-- Run this in Supabase SQL Editor to enable Account Deletion --

CREATE OR REPLACE FUNCTION delete_own_account()
RETURNS void
LANGUAGE plpgsql
SECURITY DEFINER
AS $$
BEGIN
  -- 1. Delete Game Data (Public Tables)
  DELETE FROM public.player_progress WHERE user_id = auth.uid();
  DELETE FROM public.profiles WHERE id = auth.uid();
  
  -- 2. Delete Auth User (This removes login credentials)
  DELETE FROM auth.users WHERE id = auth.uid();
END;
$$;
