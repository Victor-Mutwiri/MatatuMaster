
-- Copy everything below this line and paste it into the Supabase SQL Editor --

-- 1. Create profiles table (if it doesn't exist)
create table if not exists public.profiles (
  id uuid references auth.users not null primary key,
  username text unique,
  sacco text,
  updated_at timestamp with time zone
);

-- 2. Create player_progress table (if it doesn't exist)
create table if not exists public.player_progress (
  user_id uuid references auth.users not null primary key,
  bank_balance bigint default 0,
  total_distance float default 0,
  total_bribes bigint default 0,
  reputation int default 50,
  lifetime_earnings bigint default 0,
  unlocked_vehicles text[] default '{"boda"}',
  updated_at timestamp with time zone
);

-- 3. Enable Row Level Security (RLS)
alter table public.profiles enable row level security;
alter table public.player_progress enable row level security;

-- 4. Create Policies for profiles

-- Allow public read access to profiles (Required for Leaderboards to display names)
create policy "Public profiles are viewable by everyone."
  on profiles for select
  using ( true );

-- Allow users to insert their own profile
create policy "Users can insert their own profile."
  on profiles for insert
  with check ( auth.uid() = id );

-- Allow users to update their own profile
create policy "Users can update own profile."
  on profiles for update
  using ( auth.uid() = id );

-- 5. Create Policies for player_progress

-- Allow public read access (Required for Leaderboards)
create policy "Progress is viewable by everyone."
  on player_progress for select
  using ( true );

-- Allow users to insert their own progress
create policy "Users can insert their own progress."
  on player_progress for insert
  with check ( auth.uid() = user_id );

-- Allow users to update their own progress
create policy "Users can update own progress."
  on player_progress for update
  using ( auth.uid() = user_id );
